<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Syntax Viewer & Editor</title>
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>

<header>
    <span>Mermaid Project IDE</span>
    <div class="theme-switch-container">
        <label for="theme-toggle" class="theme-switch">
            <input type="checkbox" id="theme-toggle">
            <span class="slider"></span>
        </label>
    </div>
</header>

<main>
    <aside id="project-sidebar">
        <div id="sidebar-header">
            <h3>Projects</h3>
        </div>
        <div id="project-selector-container">
            <select id="project-selector"></select>
            <button id="new-project-btn" title="New Project">+</button>
            <button id="delete-project-btn" title="Delete Project">üóëÔ∏è</button>
        </div>
        <ul id="diagram-list">
            <!-- Diagram list items will be populated by JS -->
        </ul>
        <div id="sidebar-footer">
            <label for="upload-diagrams-input" class="sidebar-btn">Upload .mmd</label>
            <input type="file" id="upload-diagrams-input" accept=".mmd" multiple hidden>
            <button id="download-project-btn" class="sidebar-btn">Download .zip</button>
        </div>
    </aside>

    <div id="main-content">
        <button id="sidebar-toggle-btn" title="Toggle Sidebar">‚Äπ</button>
        <section id="tabs">
            <button id="code-tab" class="active" role="tab" aria-selected="true">Code</button>
            <button id="diagram-tab" role="tab" aria-selected="false">Diagram</button>
            <button id="split-view-btn">Split</button>
        </section>

        <section id="content-area">
            <div id="code-view" class="content-view active">
                <div id="toolbar">
                    <button id="new-btn">New</button>
                    <button id="save-btn">Save</button>
                    <button id="delete-btn">Delete</button>
                    <button id="rename-btn">Rename</button>
                <button id="export-mmd-btn">Export .mmd</button>
                    <button id="export-btn">Export JSON-LD</button>
                    <label for="import-file-input" id="import-label">Import JSON-LD</label>
                    <input type="file" id="import-file-input" accept=".jsonld">
                </div>
                <div id="file-info">No file open.</div>
                <textarea id="code-editor" placeholder="graph TD; A-->B;"></textarea>
            </div>

            <div id="diagram-view" class="content-view">
                <div id="diagram-toolbar">
                    <button id="render-btn">Render</button>
                </div>
                <div id="diagram-container"></div>
            </div>
        </section>
    </div>
</main>

<footer>Version 1.0</footer>

<!-- New Diagram Modal -->
<div id="new-modal" class="modal">
    <div class="modal-content">
        <h2>New Diagram</h2>
        <label for="new-name">Name:</label>
        <input type="text" id="new-name" required>
        <div class="modal-buttons">
            <button id="new-cancel-btn">Cancel</button>
            <button id="new-create-btn">Create</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<!-- <script src="app.js" type="module" defer></script> -->
<script type="module">
    import { initializeApp } from './src/synchronizations.js';
    initializeApp();
</script>
<script type="module">
    // This script connects DOM events to the application's event system.
    import { uiConcept } from './src/concepts/uiConcept.js';

    const uploadInput = document.getElementById('upload-diagrams-input');
    if (uploadInput) {
        uploadInput.addEventListener('change', (event) => {
            const files = event.target.files;
            // Publish an event to the UI concept, which will be handled in synchronizations.js
            uiConcept.notify('ui:uploadMmdClicked', { files });
        });
    }
</script>

</body>
</html>
