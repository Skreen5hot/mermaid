<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Syntax Viewer & Editor</title>
    <link rel="stylesheet" href="styles/normalize.min.css">
    <link rel="stylesheet" href="styles/skeleton.css">
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>

<header>
    <span>Mermaid Project IDE</span>
</header>

<main>
    <aside id="project-sidebar">
        <div id="sidebar-header">
            <h3>Projects</h3>
        </div>
        <div id="project-selector-container">
            <select id="project-selector" title="Project Selector"></select>
            <button id="new-project-btn" title="New Project">+</button>
            <button id="delete-project-btn" title="Delete Project">üóëÔ∏è</button>
        </div>
        <ul id="diagram-list">
            <!-- Diagram list items will be populated by JS -->
        </ul>
        <div id="sidebar-footer">
            <label for="upload-diagrams-input" class="sidebar-btn">Upload .mmd</label>
            <input type="file" id="upload-diagrams-input" accept=".mmd" multiple hidden>
            <button id="download-project-btn" class="sidebar-btn">Download .zip</button>
        </div>
    </aside>

    <div class="resizer" id="sidebar-resizer"></div>

    <div id="main-content">
        <section id="tabs">
            <button id="code-tab" class="active" role="tab" aria-selected="true">Code</button>
            <button id="diagram-tab" role="tab" aria-selected="false">Diagram</button>
            <button id="split-view-btn">Split</button>
        </section>

        <section id="content-area">
            <div id="code-view" class="content-view active">
                <div id="toolbar">
                    <button id="new-btn">New</button>
                    <button id="save-btn">Save</button>
                    <button id="delete-btn">Delete</button>
                    <button id="rename-btn">Rename</button>
                <button id="export-mmd-btn">Export .mmd</button>
                <button id="fullscreen-btn" title="Toggle Fullscreen">‚á±</button>
                </div>
                <div id="file-info">No file open.</div>
                <textarea id="code-editor" placeholder="Create a 'NEW' graph or open an existing one."></textarea>
            </div>

            <div class="resizer" id="split-view-resizer"></div>

            <div id="diagram-view" class="content-view">
                <div id="diagram-toolbar">
                    <button id="render-btn">Render</button>
                </div>
                <div id="diagram-container"></div>
            </div>
        </section>
    </div>
</main>

<footer>
    <div id="sync-status">
        <span id="sync-status-icon"></span>
        <span id="sync-status-text"></span>
    </div>
    Version 1.0
</footer>

<!-- New Diagram Modal -->
<div id="new-modal" class="modal">
    <div class="modal-content">
        <h2>New Diagram</h2>
        <label for="new-name">Name:</label>
        <input type="text" id="new-name" required>
        <div class="modal-buttons">
            <button id="new-cancel-btn">Cancel</button>
            <button id="new-create-btn">Create</button>
        </div>
    </div>
</div>

<!-- Connect Project Modal -->
<div id="connect-project-modal" class="modal">
    <div class="modal-content">
        <h2>Connect New Project</h2>
        
        <label for="connect-provider">Git Provider</label>
        <select id="connect-provider">
            <option value="github" selected>GitHub</option>
            <option value="gitlab">GitLab</option>
            <option value="local">Local</option>
        </select>

        <div id="connect-local-project-name-group" style="display: none;">
            <label for="connect-local-project-name">Project Name</label>
            <input type="text" id="connect-local-project-name" placeholder="My Awesome Project" required>
        </div>

        <div id="connect-git-fields-group">
            <label for="connect-repo-path">Repository Path (e.g., owner/repo)</label>
            <input type="text" id="connect-repo-path" placeholder="your-username/your-repo-name" required>

            <label for="connect-token">Personal Access Token</label>
            <input type="password" id="connect-token" placeholder="ghp_... or glpat_..." required>

            <div id="connect-master-password-group">
                <h3>Create a Master Password</h3>
                <p>This password encrypts your token in the browser. It is never stored or sent anywhere.</p>

                <label for="connect-password">Master Password</label>
                <input type="password" id="connect-password" required>

                <label for="connect-password-confirm">Confirm Master Password</label>
                <input type="password" id="connect-password-confirm" required>
                <div id="connect-password-error" style="color: var(--danger-color); font-size: 0.9rem; display: none;">Passwords do not match.</div>
            </div>
        </div>

        <div class="modal-buttons">
            <button id="connect-cancel-btn">Cancel</button>
            <button id="connect-submit-btn">Encrypt & Connect</button>
        </div>
    </div>
</div>

<!-- Unlock Session Modal -->
<div id="unlock-session-modal" class="modal">
    <div class="modal-content">
        <h2>Unlock Project</h2>
        <p>Enter the master password for <strong id="unlock-project-name"></strong> to start syncing.</p>
        
        <label for="unlock-password">Master Password</label>
        <input type="password" id="unlock-password" required>
        <div id="unlock-error" style="color: var(--danger-color); font-size: 0.9rem; display: none;">Incorrect password. Please try again.</div>

        <div class="modal-buttons">
            <button id="unlock-cancel-btn">Cancel</button>
            <button id="unlock-submit-btn">Unlock</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script type="module">
    // This single import initializes the entire application by running the setup
    // code within the synchronizations module.
    console.log('[index.html] Script module loaded. Initializing application...');
    import { initializeApp } from './src/synchronizations.js';

    initializeApp();
    console.log('[index.html] initializeApp() has been called.');
</script>

</body>
</html>
